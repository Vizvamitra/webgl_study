<!DOCTYPE html>
<html>
<head>
  <title>WebGL - Lightning</title>

  <script id="vertex-shader" type="x-shader/x-vertex">
    struct Light{
      vec4 position;
      vec4 ambient;
      vec4 diffuse;
      vec4 specular;
    };

    attribute vec4 vPosition;
    attribute vec4 vNormal;

    
    uniform mat4 uModelMatrix;
    uniform mat4 uViewProjMatrix;

    varying vec3 fNormal, fPosition;

    void main(){
      vec4 worldPosition = uModelMatrix*vPosition;

      gl_Position = uViewProjMatrix*worldPosition;
      fPosition = worldPosition.xyz;
      fNormal = normalize((uModelMatrix*vNormal).xyz);
    }
  </script>

  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    struct Light{
      vec4 position;
      vec4 ambient;
      vec4 diffuse;
      vec4 specular;
    };

    struct Material{
      vec4 ambient;
      vec4 diffuse;
      vec4 specular;
      float shininess;
    };
        
    uniform Light uLight;
    uniform Material uMaterial;
    uniform vec4 uCameraPos;

    varying vec3 fNormal, fPosition;

    void main(){
      vec3 L = normalize( (uLight.position.w == 0.0) ? uLight.position.xyz : uLight.position.xyz/uLight.position.w - fPosition );
      vec3 N = fNormal;
      vec3 E = normalize(uCameraPos.xyz - fPosition).xyz;
      vec3 R = normalize(reflect(L,N));

      vec4 ambient = uLight.ambient * uMaterial.ambient;

      float Kd = max( dot(N,L), 0.0);
      vec4 diffuse = Kd * (uLight.diffuse * uMaterial.diffuse);

      float Ks = pow( max( dot(E, R), 0.0), uMaterial.shininess );
      vec4 specular = Ks * (uLight.specular * uMaterial.specular);

      vec3 finalColor = (ambient+diffuse+specular).xyz;
      gl_FragColor = vec4(finalColor, 1.0);
    }
  </script>

  <link rel="stylesheet" type="text/css" href="css/main.css">

  <script type="text/javascript" src="../../common/webgl_utils.js"></script>
  <script type="text/javascript" src="../../common/init_shaders.js"></script>
  <script type="text/javascript" src="../../common/mv.js"></script>
  <script type="text/javascript" src="js/meshes/cube.js"></script>
  <script type="text/javascript" src="js/meshes/sphere.js"></script>
  <script type="text/javascript" src="js/meshes/torus.js"></script>
  <script type="text/javascript" src="js/meshes/monkey.js"></script>
  <script type="text/javascript" src="js/renderer.js"></script>
  <script type="text/javascript" src="js/camera.js"></script>
  <script type="text/javascript" src="js/light.js"></script>
  <script type="text/javascript" src="js/instance.js"></script>
  <script type="text/javascript" src="js/scene.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
</head>
<body>
  <a href='../../index.html'>Back</a> | <a href='https://github.com/Vizvamitra/webgl_study/tree/master/7/00_lightning'>Github</a><br><br>

  <div class='container'>
    <canvas id='gl-canvas' width=300 height=300>
      Canvas is not supported by your browser...
    </canvas>

    <form class='controls'>
      <fieldset class='ranges'>
        <label for='rotationSpeed'>Rotation speed</label>
        <output class='rotationSpeed'>1</output>
        <input type='range' name='rotationSpeed' min=0 max=5 step=0.1 value=1 oninput='onRotationSpeedChange(event)'><br>
      </fieldset>

      <fieldset>
        <label style='vertical-align: top;'>Rotation axis:</label>
        <select id='axis' name='axis' size=3 onchange='onRotationAxisChange(event);'>
          <option value='0'> x </option>
          <option selected value='1'> y </option>
          <option value='2'> z </option>
        </select><br><br>

        <button onclick='onRotationDirectionChange(event);'>Change rotation direction</button>
      </fieldset>
    </form>
  </div>

</body>
</html>